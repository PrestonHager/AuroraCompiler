# generator.py
# by Preston Hager
# for Aurora Compiler

class Generator:
    def __init__(self, parser):
        """
        Creates a new Generator instance

        Parameters
        ----------
        parser : Parser
            Parser to link to the generator

        Returns
        -------
        Generator
            New Generator instance with previous parameters.
        """
        self.parser = parser
        self.generated_code = "; generated by Aurora Compiler by Preston Hager\n; https://github.com/PrestonHager/AuroraCompiler\n[BITS 32]\n\n"

    def generate(self):
        """
        Generates new code from the parser's AST
        """
        for node in self.parser.ast.children:
            self.generated_code += self._generate(node)

    def _generate(self, node):
        generated = ""
        if node.name == "COMMENT":
            generated += f"; {node.children[0].value.strip()}"
        if node.name == "FUNCTION":
            for child in node.children:
                if child.name == "NAME":
                    name = child.value
                elif child.name == "ARGUMENTS":
                    arguments = child.children
            if name == "include":
                file = arguments[0]
                generated += f"%include \"{file}\""
            elif name == "_asm":
                generated += f"{arguments}"
            else:
                generated += f"; Arguments: {arguments}\ncall {name}"
        return generated.strip()+"\n"
